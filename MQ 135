#define MQ135_PIN 34
#define SAMPLE_COUNT 10      // Number of readings to average
#define SAMPLE_INTERVAL 50   // Interval between readings (in ms)
#define REPORT_INTERVAL 500  // Time between data reports (in ms)

unsigned long previousReportTime = 0;

void setup() {
  Serial.begin(115200);
  delay(1000);
  Serial.println("------ Efficient Air Quality Monitor Started ------");
  Serial.println("Time (s)\tAnalog\tVoltage (V)\tStatus");
}

void loop() {
  unsigned long currentMillis = millis();

  // Only report data every REPORT_INTERVAL ms
  if (currentMillis - previousReportTime >= REPORT_INTERVAL) {
    previousReportTime = currentMillis;

    unsigned long elapsedTime = currentMillis / 1000;

    // Take multiple samples and average them
    long totalAnalog = 0;
    for (int i = 0; i < SAMPLE_COUNT; i++) {
      totalAnalog += analogRead(MQ135_PIN);
      delay(SAMPLE_INTERVAL);  // Small delay between samples
    }

    int analogValue = totalAnalog / SAMPLE_COUNT;
    float voltage = analogValue * (3.3 / 4095.0);

    String status;
    if (analogValue <= 1500) {
      status = "Good";
    } else if (analogValue <= 3000) {
      status = "Moderate";
    } else {
      status = "Poor";
    }

    Serial.print(elapsedTime);
    Serial.print("\t\t");
    Serial.print(analogValue);
    Serial.print("\t");
    Serial.print(voltage, 3);
    Serial.print("\t\t");
    Serial.println(status);
  }

  // No delay here â†’ non-blocking
}
