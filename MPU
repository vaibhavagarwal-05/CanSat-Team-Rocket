#include <Wire.h>
#include <Adafruit_MPU6050.h>
#include <Adafruit_Sensor.h>

#define SDA_PIN 21
#define SCL_PIN 22

Adafruit_MPU6050 mpu;

// Sampling rate (adjust as needed)
const unsigned long MPU_INTERVAL_US = 200000; // 10,000 µs = 100 Hz
unsigned long lastMPUTime = 0;

void setup() {
  Serial.begin(115200);
  delay(1000);
  Serial.println("Initializing MPU6050...");

  Wire.begin(SDA_PIN, SCL_PIN);

  if (!mpu.begin()) {
    Serial.println("Could not find a valid MPU6050 sensor, check wiring!");
    while (1) delay(1000);
  }
  Serial.println("MPU6050 Found!");

  // Sensor configuration
  mpu.setAccelerometerRange(MPU6050_RANGE_4_G);
  mpu.setGyroRange(MPU6050_RANGE_250_DEG);
  mpu.setFilterBandwidth(MPU6050_BAND_44_HZ);
}

void loop() {
  unsigned long now = micros();

  if (now - lastMPUTime >= MPU_INTERVAL_US) {
    lastMPUTime = now;

    sensors_event_t a, g, temp;
    mpu.getEvent(&a, &g, &temp);

    // Efficient printing/logging
    Serial.print("Accel(m/s^2): X=");
    Serial.print(a.acceleration.x, 2);
    Serial.print(" Y=");
    Serial.print(a.acceleration.y, 2);
    Serial.print(" Z=");
    Serial.print(a.acceleration.z, 2);

    Serial.print(" | Gyro(rad/s): X=");
    Serial.print(g.gyro.x, 2);
    Serial.print(" Y=");
    Serial.print(g.gyro.y, 2);
    Serial.print(" Z=");
    Serial.print(g.gyro.z, 2);

    Serial.println();
  }

  // No delay → here you can add:
  // - BMP readings
  // - Telemetry transmission
  // - SD card logging
  // - Flight control logic
}
